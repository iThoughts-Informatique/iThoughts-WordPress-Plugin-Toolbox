{"version":3,"sources":["../src/simple-ajax-form-v5.js"],"names":["$","ithoughts","fn","extend","simpleAjaxForm","opts","defaults","validate","options","each","bindEach","$form","formopts","target","data","callback","length","html","hide","find","click","onClick","val","value","postText","getAttribute","loader","ajaxForm","beforeSubmit","removeClass","addClass","fadeTo","makeLoader","error","remove","success","responseText","statusText","xhr","jQForm","res","constructor","name","JSON","parse","valid","text","reload","window","location","href","encodeURI","redirect","setTimeout","simple_ajax_callback","e","console","$d","ready","iThoughts","v5"],"mappings":"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","file":"simple-ajax-form-v5.js","sourcesContent":["/**\n * @file Simple AJAX Form\n * @description jQuery extension to make forms AJAX enabled. Mainly used in WordPress projects\n *\n * @author Gerkin, tcbarrett\n * @copyright 2016\n * @license https://www.gnu.org/licenses/gpl-3.0.html GPLv3\n * @package iThoughts-toolbox\n *\n */\n\n'use strict';\n\n( ithoughts => {\n\n\tvar $ = ithoughts.$;\n\t$.fn.extend({\n\t\t/**\n\t\t * Send a form through ajax\n\t\t * @function simpleAjaxForm\n\t\t * @memberof\texternal:jQuery\n\t\t * @param   {object} opts Options\n\t\t * @param   {boolean} [opts.validate=false] Options\n\t\t * @param   {function} [opts.callback=false] Options\n\t\t * @returns {undefined}\n\t\t */\n\t\tsimpleAjaxForm( opts ) {\n\t\t\tvar defaults = {\n\t\t\t\tvalidate: false,\n\t\t\t};\n\t\t\tvar options  = $.extend( defaults, opts );\n\t\t\tthis.each( function bindEach() {\n\t\t\t\tvar $form = $( this );\n\t\t\t\tvar formopts = $.extend({\n\t\t\t\t\ttarget:   $form.data( 'target' ),\n\t\t\t\t\tcallback: $form.data( 'callback' ),\n\t\t\t\t}, options );\n\t\t\t\tif ( formopts.target && $( `#${ formopts.target }` ).length ) {\n\t\t\t\t\t$( `#${ formopts.target }` ).html( '' ).hide();\n\t\t\t\t}\n\t\t\t\t$form.find( 'button[name=\"actionB\"]' ).click( function onClick() {\n\t\t\t\t\t$form.find( '[name=\"action\"]' ).val( this.value );\n\t\t\t\t});\n\t\t\t\tvar postText = ( this.getAttribute( 'post_text' ) ? this.getAttribute( 'post_text' ) : 'Updating, please wait...' ),\n\t\t\t\t\tloader;\n\n\t\t\t\t$form.ajaxForm({\n\t\t\t\t\tbeforeSubmit() {\n\t\t\t\t\t\t//if( !jqForm.valid() ) return false;\n\t\t\t\t\t\tif ( formopts.target && $( `#${ formopts.target }` ).length ) {\n\t\t\t\t\t\t\t$( `#${ formopts.target }` ).html( `<p>${  postText  }</p>` ).removeClass().addClass( 'clear updating' ).fadeTo( 100, 1 );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tloader = ithoughts.makeLoader();\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\t\t\t\t\terror() {\n\t\t\t\t\t\tloader.remove();\n\t\t\t\t\t\t$( `#${ formopts.target }` ).removeClass().addClass( 'clear notice notice-error' ).html( '<p>Form submission failed.</p>' );\n\t\t\t\t\t},\n\t\t\t\t\tsuccess( responseText, statusText, xhr, jQForm ) {\n\t\t\t\t\t\tloader.remove();\n\t\t\t\t\t\tif ( 'undefined' === typeof( jQForm )) {\n\t\t\t\t\t\t\tjQForm = xhr;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tvar res;\n\t\t\t\t\t\t\tif ( 'String' === responseText.constructor.name ) {\n\t\t\t\t\t\t\t\tres = JSON.parse( responseText );\n\t\t\t\t\t\t\t} else if ( 'Object' === responseText.constructor.name ) {\n\t\t\t\t\t\t\t\tres = responseText;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthrow `Unhandled type ${  typeof responseText }`;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( '0' === res || !res ) {\n\t\t\t\t\t\t\t\t$( `#${ formopts.target }` ).removeClass().addClass( 'clear notice notice-warning' ).html( '<p>Server did not respond anything</p>' );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif ( typeof res.success != 'undefined' && res.success != null && typeof res.data != 'undefined' && res.data != null ) { // handle wp_send_json_{success|error}\n\t\t\t\t\t\t\t\t\tres.data.valid = res.success;\n\t\t\t\t\t\t\t\t\tres = res.data;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// Handle raw response\n\t\t\t\t\t\t\t\tif ( !res.valid ) {\n\t\t\t\t\t\t\t\t\tif ( formopts.target && $( `#${ formopts.target }` ).length ) {\n\t\t\t\t\t\t\t\t\t\t$( `#${ formopts.target }` ).removeClass().addClass( 'clear notice notice-error' ).html( res.text );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif ( res.reload ) {\n\t\t\t\t\t\t\t\t\t\twindow.location.href = `${ window.location.href  }&json-res-txt=${  window.encodeURI( res.text ) }`;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif ( formopts.target && $( `#${ formopts.target }` ).length ) {\n\t\t\t\t\t\t\t\t\t\t$( `#${ formopts.target }` ).removeClass().addClass( 'clear notice notice-success' ).html( res.text );\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif ( res.redirect ) {\n\t\t\t\t\t\t\t\t\t\tif ( res.text ) {\n\t\t\t\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\t\t\t\twindow.location.href = res.redirect;\n\t\t\t\t\t\t\t\t\t\t\t}, 2500 );\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\twindow.location.href = res.redirect;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tif ( 'function' == typeof $form[0].simple_ajax_callback )\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t$form[0].simple_ajax_callback( res );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif ( 'function' == typeof formopts.callback )\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tformopts.callback( res );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch ( e ) {\n\t\t\t\t\t\t\t\t\t$( `#${ formopts.target }` ).removeClass().addClass( 'clear notice notice-error' ).html( '<p>Error with received data</p>' );\n\t\t\t\t\t\t\t\t\tconsole.error( e );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch ( e ) {\n\t\t\t\t\t\t\t$( `#${ formopts.target }` ).removeClass().addClass( 'clear notice notice-error' ).html( '<p>Invalid server response</p>' );\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t});\n\n\tithoughts.$d.ready(() => {\n\t\t$( '.simpleajaxform' ).simpleAjaxForm();\n\t});\n})( iThoughts.v5 );\n"]}